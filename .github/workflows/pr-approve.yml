name: Random bot PR approve

on:
  schedule:
    - cron: "15 10 * * *"   # every day at 10:15 UTC
  workflow_dispatch:

permissions:
  pull-requests: write

jobs:
  pr-approve-bot:
    runs-on: ubuntu-latest
    env:
      TARGET_REPO: ${{ github.repository }}

    steps:
      - name: Approve up to 3 bot PRs
        env:
          GH_TOKEN: ${{ secrets.PERSONAL_ACCESS_TOKEN }}   # reviewer = you (sreekaran)
        run: |
          set -euo pipefail

          echo "Looking for up to 3 open bot PRs with 'Random bot PR' in the title."

          pr_numbers=$(gh pr list \
            --repo "$TARGET_REPO" \
            --state open \
            --limit 50 \
            | awk '/Random bot PR/ {print $1}' \
            | head -n 3)

          if [[ -z "${pr_numbers}" ]]; then
            echo "No matching open bot PRs found."
            exit 0
          fi

          for num in $pr_numbers; do
            echo "Approving bot PR #$num as user 'sreekaran'"
            gh pr review "$num" \
              --repo "$TARGET_REPO" \
              --approve \
              --body "Automated review of bot PR: looks good to me."
          done
