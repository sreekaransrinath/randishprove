name: Random issue create

on:
  schedule:
    - cron: "0 10 * * *"   # every day at 10:00 UTC
  workflow_dispatch:

permissions:
  issues: write

jobs:
  issue-create:
    runs-on: ubuntu-latest
    env:
      TARGET_REPO: ${{ github.repository }}

    steps:
      - name: Create 2â€“4 random issues on even day-of-year
        env:
          GH_TOKEN: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
        run: |
          set -euo pipefail

          DAY_OF_YEAR=$(date -u +%j)

          if (( DAY_OF_YEAR % 2 == 1 )); then
            echo "Day-of-year $DAY_OF_YEAR is odd, skipping issue creation."
            exit 0
          fi

          MIN=2
          MAX=4
          COUNT=$(( RANDOM % (MAX - MIN + 1) + MIN ))

          echo "Creating $COUNT random issues in $TARGET_REPO (even day-of-year $DAY_OF_YEAR)."

          for ((i=1; i<=COUNT; i++)); do
            TS="$(date -u +%Y-%m-%dT%H:%M:%SZ)"
            TITLE="Random issue $TS #$i"
            BODY="Auto-generated issue $i at $TS from workflow run ${GITHUB_RUN_ID:-local}."

            gh issue create \
              --repo "$TARGET_REPO" \
              --title "$TITLE" \
              --body "$BODY"
          done
