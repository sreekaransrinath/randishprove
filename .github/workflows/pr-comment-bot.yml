name: Random bot PR comment

on:
  schedule:
    - cron: "25 10 * * *"   # every day at 10:25 UTC
  workflow_dispatch:

permissions:
  pull-requests: write

jobs:
  pr-comment-bot:
    runs-on: ubuntu-latest
    env:
      TARGET_REPO: ${{ github.repository }}

    steps:
      - name: Comment on bot PRs every other day (odd days only)
        env:
          GH_TOKEN: ${{ secrets.PERSONAL_ACCESS_TOKEN }}   # comments authored as you (sreekaran)
        run: |
          set -euo pipefail

          DAY_OF_YEAR=$(date -u +%j)

          # Only run on odd days-of-year
          if (( DAY_OF_YEAR % 2 == 0 )); then
            echo "Day-of-year $DAY_OF_YEAR is even, skipping bot PR comments."
            exit 0
          fi

          echo "Day-of-year $DAY_OF_YEAR is odd. Commenting on all open bot PRs."

          pr_numbers=$(gh pr list \
            --repo "$TARGET_REPO" \
            --state open \
            --limit 100 \
            | awk '/Random bot PR/ {print $1}')

          if [[ -z "${pr_numbers}" ]]; then
            echo "No matching open bot PRs found."
            exit 0
          fi

          for num in $pr_numbers; do
            echo "Commenting on bot PR #$num"
            gh pr comment "$num" \
              --repo "$TARGET_REPO" \
              --body "Automated comment on bot PR (odd day-of-year $DAY_OF_YEAR)."
          done
